<!doctype html>
<html lang="en-us">
    <head>
        <title>Vipster</title>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,user-scalable=no">
        <style>
            body{
                font-family: arial;
                margin: 0;
                padding: none;
            }
            canvas.emscripten{
                border:0px none;
                background-color: white;
                width: 100vw;
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <input type="file" id="upload">
        X:
        <input type="number" id="xmult" min="1">
        Y:
        <input type="number" id="ymult" min="1">
        Z:
        <input type="number" id="zmult" min="1">
        <output id="output"></output>
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
        <script type="text/javascript">
            var Module = {
                preRun: [],
                postRun: [],
                canvas: (function() {
                  var canvas = document.getElementById('canvas');
                  canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);
                  canvas.width = window.innerWidth;
                  canvas.height = window.innerHeight;
                  return canvas;
                })(),
            };
            window.addEventListener("resize", function(e){ Module.canvas.width=window.innerWidth; Module.canvas.height=window.innerHeight;}, false);
            function readFile(e){
                var file = e.target.files[0];
                var reader = new FileReader();
                reader.onload = function(e){
                    Module.FS_createDataFile("/tmp","test.file", e.target.result, true);
                    Module.ccall("emReadFile", null, ['string', 'number'], ["/tmp/test.file", Module.IOFmt.XYZ.value]);
                    Module.FS_unlink("/tmp/test.file")
                };
                reader.readAsText(file);
                document.getElementById('output').innerHTML = "Success!";
            };
            document.getElementById('upload').addEventListener('change', readFile, false);
            function setMult(e){
                var x = document.getElementById('xmult').value;
                var y = document.getElementById('ymult').value;
                var z = document.getElementById('zmult').value;
                Module.ccall("emSetMult", null, ['number', 'number', 'number'], [x,y,z]);
            }
            document.getElementById('xmult').addEventListener('change', setMult, false);
            document.getElementById('ymult').addEventListener('change', setMult, false);
            document.getElementById('zmult').addEventListener('change', setMult, false);
        </script>
        <script async type="text/javascript" src="js/vipster.js"></script>
    </body>
</html>
